unit connect;

interface

uses
  System.SysUtils, FireDAC.Comp.Client, FireDAC.Phys.PG, Vcl.Dialogs;

function CrearConexion(Servidor, BaseDatos, Usuario, Clave: string; Puerto: Integer = 5432): TFDConnection;
function CrearQuery(Conexion: TFDConnection): TFDQuery;

implementation

// Crea una conexión a PostgreSQL
function CrearConexion(const Host, DBName, User, Pass: string; Port: Integer): TFDConnection;
begin
  Result := TFDConnection.Create(nil);
  try
    Result.LoginPrompt := False;

    // ?? Indicar el driver PostgreSQL
    Result.DriverName := 'PG';

    Result.Params.Values['Server'] := Host;
    Result.Params.Values['Database'] := DBName;
    Result.Params.Values['User_Name'] := User;
    Result.Params.Values['Password'] := Pass;
    Result.Params.Values['Port'] := IntToStr(Port);

    Result.Connected := True;
  except
    on E: Exception do
    begin
      ShowMessage('Error al conectar: ' + E.Message);
      Result.Free;
      Result := nil;
    end;
  end;
end;


// Crea un query usando una conexión
function CrearQuery(Conexion: TFDConnection): TFDQuery;
begin
  Result := TFDQuery.Create(nil);
  Result.Connection := Conexion;
end;

end.

