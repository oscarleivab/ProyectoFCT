unit connect;

interface

uses
  System.SysUtils, FireDAC.Comp.Client, FireDAC.Phys.PG, Vcl.Dialogs;

function CrearConexion(Servidor, BaseDatos, Usuario, Clave: string; Puerto: Integer = 5432): TFDConnection;
function CrearQuery(Conexion: TFDConnection): TFDQuery;

implementation

// Crea una conexión a PostgreSQL
function CrearConexion(Servidor, BaseDatos, Usuario, Clave: string; Puerto: Integer): TFDConnection;
begin
  Result := TFDConnection.Create(nil);
  Result.LoginPrompt := False;
  //Result.DriverName := 'PG';

  Result.Params.Clear;
  Result.Params.Add('Server=' + Servidor);
  Result.Params.Add('Database=' + BaseDatos);
  Result.Params.Add('User_Name=' + Usuario);
  Result.Params.Add('Password=' + Clave);
  Result.Params.Add('Port=' + IntToStr(Puerto));

  // Intentar conectar
  try
    Result.Connected := True;
  except
    ShowMessage('No se pudo conectar a la base de datos.');
    Result.Free;
    Result := nil;
  end;
end;

// Crea un query usando una conexión
function CrearQuery(Conexion: TFDConnection): TFDQuery;
begin
  Result := TFDQuery.Create(nil);
  Result.Connection := Conexion;
end;

end.

