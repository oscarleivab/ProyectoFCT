unit connect;

interface

uses
  System.SysUtils, FireDAC.Comp.Client, Vcl.Dialogs;

function ConfigurarConexion(FDConn: TFDConnection; Servidor, BaseDatos, Usuario, Clave: string; Puerto: Integer = 5432): Boolean;
function CrearQuery(Conexion: TFDConnection): TFDQuery;

implementation

// Configura un TFDConnection existente
function ConfigurarConexion(FDConn: TFDConnection; Servidor, BaseDatos, Usuario, Clave: string; Puerto: Integer): Boolean;
begin
  Result := False;
  FDConn.Connected := False;
  FDConn.Params.Clear;

  // 🔹 Asignar el driver (necesario aunque tengamos FDPhysPgDriverLink)
  FDConn.DriverName := 'PG';

  // Configurar parámetros
  FDConn.Params.Values['Server'] := Servidor;
  FDConn.Params.Values['Database'] := BaseDatos;
  FDConn.Params.Values['User_Name'] := Usuario;
  FDConn.Params.Values['Password'] := Clave;
  FDConn.Params.Values['Port'] := IntToStr(Puerto);

  // Intentar conectar
  try
    FDConn.Connected := True;
    Result := True;
  except
    on E: Exception do
      ShowMessage('❌ No se pudo conectar: ' + E.Message);
  end;
end;

// Crear un query usando la conexión pasada
function CrearQuery(Conexion: TFDConnection): TFDQuery;
begin
  Result := TFDQuery.Create(nil);
  Result.Connection := Conexion;
end;

end.

